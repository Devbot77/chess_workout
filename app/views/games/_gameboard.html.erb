<table class="board" id="chessboard">
  <% @game.black_player == current_user ? (index = 8.downto(1)) : (index = (1..8)) %>
  <% index.each do |row| %>
    <tr>
      <% index.each do |col| %>
        <% sq_color = (row + col).even? ? 'white_sq' : 'dark_sq' %>
        <td id="<%= "#{row}#{col}" %>" class="<%= sq_color %>">

          <% piece = @game.pieces.where(:x_position => col, :y_position => row).order("updated_at DESC").first %>
          <% if piece && piece.captured.blank? %>
            <div class="piece <%= piece.color %>_piece" id="<%= piece.color %>-<%= piece.type %>" data-piece-url="<%= piece_path(piece) %>">
              <strong><%= piece.type %></strong>
            </div>
          <% else %>
            <div class="blank"></div>
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>